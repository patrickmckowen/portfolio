/**
 * # MCP to CLI
 *
 * Dynamically generates CLI commands from MCP (Model Context Protocol) server tools.
 * This module connects to any MCP server, discovers available tools, and creates
 * corresponding CLI commands with proper argument parsing and validation.
 *
 * ## Features
 *
 * - **Auto-discovery**: Fetches all tools from the MCP server and creates CLI commands
 * - **Caching**: Tools are cached for 1 hour to avoid reconnecting on every invocation
 * - **Session reuse**: MCP session IDs are cached to skip initialization handshake
 * - **Type-aware parsing**: Handles string, number, boolean, object, and array arguments
 * - **JSON schema support**: Generates CLI options from tool input schemas
 * - **OAuth support**: Automatic OAuth authentication on 401 errors (lazy auth)
 *
 * ## Example Usage
 *
 * ```ts
 * import { cac } from '@xmorse/cac'
 * import { addMcpCommands } from 'mcpcac'
 *
 * const cli = cac('mycli')
 *
 * await addMcpCommands({
 *   cli,
 *   commandPrefix: 'mcp',
 *   clientName: 'my-mcp-client',
 *   getMcpUrl: () => loadConfig().mcpUrl,
 *   oauth: {
 *     clientName: 'My CLI',
 *     load: () => loadConfig().mcpOauth,
 *     save: (state) => saveConfig({ mcpOauth: state }),
 *   },
 *   loadCache: () => loadConfig().cachedMcpTools,
 *   saveCache: (cache) => saveConfig({ cachedMcpTools: cache }),
 * })
 *
 * // Login command just saves URL - no auth check, fast!
 * cli.command('login [url]').action((url) => {
 *   saveConfig({ mcpUrl: url })
 *   console.log('URL saved.')
 * })
 *
 * cli.parse()
 * ```
 *
 * @module mcpcac
 */
import type { Transport } from "@modelcontextprotocol/sdk/shared/transport.js";
import type { CAC } from "@xmorse/cac";
import type { McpOAuthConfig } from "./types.js";
export type { Transport };
export type { McpOAuthConfig, McpOAuthState } from "./types.js";
export interface CachedMcpTools {
    tools: Array<{
        name: string;
        description?: string;
        inputSchema?: unknown;
    }>;
    timestamp: number;
    sessionId?: string;
}
export interface AddMcpCommandsOptions {
    cli: CAC;
    /**
     * Prefix for all MCP tool commands.
     * Set to empty string '' for no prefix (e.g., 'notion-search' instead of 'mcp notion-search').
     * @default 'mcp'
     */
    commandPrefix?: string;
    /**
     * Name used when connecting to the MCP server.
     * @default 'mcp-cli-client'
     */
    clientName?: string;
    /**
     * Returns the MCP server URL, or undefined if not configured.
     * Required when using the oauth option.
     */
    getMcpUrl?: () => string | undefined;
    /**
     * Returns a transport to connect to the MCP server, or null if not configured.
     * If null is returned, no MCP tool commands will be registered.
     * @param sessionId - Optional session ID from cache to reuse existing session
     *
     * @deprecated Use getMcpUrl + oauth instead for simpler setup
     */
    getMcpTransport?: (sessionId?: string) => Transport | null | Promise<Transport | null>;
    /**
     * OAuth configuration. When provided, enables automatic OAuth authentication.
     *
     * OAuth is lazy - no auth check happens on startup. Authentication is only
     * triggered when a tool call returns 401. After successful auth, the tool
     * call is automatically retried.
     *
     * The library handles everything internally:
     * - Detecting 401 errors
     * - Starting local callback server on random port
     * - Opening browser for authorization
     * - Exchanging code for tokens
     * - Persisting tokens via save()
     * - Retrying the failed tool call
     */
    oauth?: McpOAuthConfig;
    /**
     * Load cached MCP tools. Return undefined if no cache exists.
     */
    loadCache: () => CachedMcpTools | undefined;
    /**
     * Save cached MCP tools. Pass undefined to clear the cache.
     */
    saveCache: (cache: CachedMcpTools | undefined) => void;
}
/**
 * Adds MCP tool commands to a cac CLI instance.
 *
 * Tools are cached for 1 hour to avoid connecting on every CLI invocation.
 * Session ID is also cached to skip MCP initialization handshake.
 *
 * OAuth is lazy - authentication only happens when a 401 error occurs.
 * After successful auth, the operation is automatically retried.
 */
export declare function addMcpCommands(options: AddMcpCommandsOptions): Promise<void>;
//# sourceMappingURL=index.d.ts.map